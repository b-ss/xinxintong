!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=76)}({0:function(e,t,n){"use strict";var o=angular.module("http.ui.xxt",["ng"]);o.provider("tmsLocation",function(){var e;this.config=function(t){e=t||location.pathname},this.$get=["$location",function(t){return e||(e=location.pathname),{s:function(){var e=t.search();if(arguments.length){for(var n=[],o=0,r=arguments.length;o<r;o++)n.push(arguments[o]+"="+(e[arguments[o]]||""));return n.join("&")}return e},j:function(n){var o=e,r=[];n&&n.length&&(o+="/"+n);for(var a=1,i=arguments.length;a<i;a++)r.push(arguments[a]+"="+(t.search()[arguments[a]]||""));return r.length&&(o+="?"+r.join("&")),o},path:function(){return arguments.length?t.path(arguments[0]):t.path()}}}]}),o.service("http2",["$rootScope","$http","$timeout","$q","$sce","$compile",function(e,t,n,o,r,a){function i(t,n,o){var i;return r.trustAsHtml(t),i=angular.element("<div></div>"),i.attr({class:"tms-notice-box alert alert-"+(n||"info"),"ng-style":"{'z-index':1099}"}).html(t),o||i[0].addEventListener("click",function(){document.body.removeChild(i[0])},!0),a(i)(e),document.body.appendChild(i[0]),i[0]}function s(e){e&&document.body.removeChild(e)}function l(e){return!(!e.page||!angular.isObject(e.page))&&(void 0===e.page.at&&(e.page.at=1),void 0===e.page.size&&(e.page.size=12),void 0!==e.page.j&&angular.isFunction(e.page.j)||(e.page.j=function(){return"page="+this.at+"&size="+this.size}),!0)}function c(e,t,n){if(t){if(e){if(angular.isArray(e)){e.length>t.length&&e.splice(t.length-1,e.length-t.length);for(var o=0,r=t.length;o<r;o++)o<e.length?c(e[o],t[o],n):e.push(t[o])}else if(angular.isObject(e)){for(var a in e)n&&-1!==n.indexOf(a)||(void 0===t[a]?delete e[a]:angular.isObject(t[a])&&angular.isObject(e[a])?c(e[a],t[a],n):e[a]=t[a]);for(var a in t)n&&-1!==n.indexOf(a)||void 0===e[a]&&(e[a]=t[a])}}else e=t;return!0}}this.get=function(e,r){var a,c,d=o.defer();return r=angular.extend({headers:{accept:"application/json"},parseResponse:!0,autoBreak:!0,autoNotice:!0,showProgress:!0,showProgressDelay:500,showProgressText:"正在获取数据..."},r),!0===r.showProgress&&(c=n(function(){c=null,a=i(r.showProgressText,"info")},r.showProgressDelay)),l(r)&&(e+=(-1===e.indexOf("?")?"?":"&")+r.page.j()),t.get(e,r).success(function(e){if(r.page&&void 0!==e.data.total&&(r.page.total=e.data.total),!0===r.showProgress&&(c&&n.cancel(c),a&&(s(a),a=null)),r.parseResponse)if(angular.isString(e)){if(r.autoNotice&&i(e,"warning"),r.autoBreak)return;d.reject(e)}else if(e.err_code&&0!=e.err_code){if(r.autoNotice){var t;t=angular.isString(e.err_msg)?e.err_msg:angular.isArray(e.err_msg)?e.err_msg.join("<br>"):JSON.stringify(e.err_msg),i(t,"warning")}if(r.autoBreak)return;d.reject(e)}else d.resolve(e);else d.resolve(e)}).error(function(e,t){!0===r.showProgress&&(c&&n.cancel(c),a&&(s(a),a=null)),i(null===e?"网络不可用":e,"danger")}),d.promise},this.post=function(e,r,a){var c,d,u=o.defer();return a=angular.extend({headers:{accept:"application/json"},parseResponse:!0,autoBreak:!0,autoNotice:!0,showProgress:!0,showProgressDelay:500,showProgressText:"正在获取数据..."},a),!0===a.showProgress&&(d=n(function(){d=null,c=i(a.showProgressText,"info")},a.showProgressDelay)),l(a)&&(e+=(-1===e.indexOf("?")?"?":"&")+a.page.j()),t.post(e,r,a).success(function(e){if(a.page&&void 0!==e.data.total&&(a.page.total=e.data.total),!0===a.showProgress&&(d&&n.cancel(d),c&&(s(c),c=null)),a.parseResponse)if(angular.isString(e)){if(a.autoNotice&&(i(e,"warning"),c=null),a.autoBreak)return;u.reject(e)}else if(0!=e.err_code){if(a.autoNotice){var t;t=angular.isString(e.err_msg)?e.err_msg:angular.isArray(e.err_msg)?e.err_msg.join("<br>"):JSON.stringify(e.err_msg),i(t,"warning")}if(a.autoBreak)return;u.reject(e)}else u.resolve(e);else u.resolve(e)}).error(function(e,t){!0===a.showProgress&&(d&&n.cancel(d),c&&(s(c),c=null)),i(null===e?"网络不可用":e,"danger")}),u.promise},this.merge=function(e,t,n){return!angular.equals(e,t)&&c(e,t,n)}}])},1:function(module,exports,__webpack_require__){"use strict";var ngMod=angular.module("page.ui.xxt",[]);ngMod.directive("dynamicHtml",["$compile",function(e){return{restrict:"EA",replace:!0,link:function(t,n,o){t.$watch(o.dynamicHtml,function(o){o&&o.length&&(n.html(o),e(n.contents())(t))})}}}]),ngMod.service("tmsDynaPage",["$q",function($q){this.loadCss=function(e){var t,n;t=document.createElement("style"),t.innerHTML=e,n=document.querySelector("head"),n.appendChild(t)},this.loadExtCss=function(e){var t,n;t=document.createElement("link"),t.href=e,t.rel="stylesheet",n=document.querySelector("head"),n.appendChild(t)},this.loadJs=function(ngApp,js){!function(ngApp){eval(js)}(ngApp)},this.loadScript=function(e){var t,n,o=$q.defer();return n=function(){var r;r=document.createElement("script"),r.src=e[t],r.onload=function(){t++,t<e.length?n():o.resolve()},document.body.appendChild(r)},e&&(angular.isString(e)&&(e=[e]),e.length&&(t=0,n())),o.promise},this.loadExtJs=function(e,t){var n,o=this,r=$q.defer(),a=t.ext_js.length;return n=function(n){var i;i=document.createElement("script"),i.src=n.url,i.onload=function(){0===--a&&(t.js&&t.js.length&&o.loadJs(e,t.js),r.resolve())},document.body.appendChild(i)},t.ext_js&&t.ext_js.length&&t.ext_js.forEach(n),r.promise},this.loadCode=function(e,t){var n=this,o=$q.defer();return t.ext_css&&t.ext_css.length&&t.ext_css.forEach(function(e){n.loadExtCss(e.url)}),t.css&&t.css.length&&this.loadCss(t.css),t.ext_js&&t.ext_js.length?n.loadExtJs(e,t).then(function(){o.resolve()}):(t.js&&t.js.length&&n.loadJs(e,t.js),o.resolve()),o.promise},this.openPlugin=function(e){var t,n,o,r,a,i;return i=$q.defer(),e||(console.log("参数为空"),i.reject()),document.documentElement.clientWidth>768?document.documentElement.scrollTop=0:document.body.scrollTop=0,a=document.getElementsByTagName("body")[0],r=document.getElementsByTagName("html")[0],r.style.cssText="height:100%;",a.style.cssText="height:100%;overflow-y:hidden",t=document.createDocumentFragment(),n=document.createElement("div"),n.setAttribute("id","frmPlugin"),o=document.createElement("iframe"),n.appendChild(o),n.onclick=function(){n.parentNode.removeChild(n),a.style.cssText="overflow-y:auto"},t.appendChild(n),document.body.appendChild(t),0===e.indexOf("http")?(window.onClosePlugin=function(e){n.parentNode.removeChild(n),a.style.cssText="overflow-y:auto",i.resolve(e)},o.setAttribute("src",e)):o.contentDocument&&o.contentDocument.body&&(o.contentDocument.body.innerHTML=e),i.promise}}])},43:function(e,t,n){"use strict";n(!function(){var e=new Error('Cannot find module "./directive.css"');throw e.code="MODULE_NOT_FOUND",e}()),n(!function(){var e=new Error('Cannot find module "./preview.css"');throw e.code="MODULE_NOT_FOUND",e}()),n(0),n(1),n(6);var o=angular.module("app",["ngSanitize","http.ui.xxt","page.ui.xxt","directive.enroll"]);o.config(["$locationProvider",function(e){e.html5Mode(!0)}]),o.controller("ctrlMain",["$scope","http2","$timeout","tmsLocation","tmsDynaPage",function(e,t,n,r,a){function i(){var i=r.j("get","site","app","ek","openAt","page");t.get(i,{autoBreak:!1}).then(function(t){var r=t.data,i=r.site,s=r.app,l=r.mission;e.schemasById={},s.dataSchemass&&s.dataSchemas.forEach(function(t){e.schemasById[t.id]=t}),e.params=r,e.site=i,e.mission=l,e.app=s,e.user=r.user,e.activeRound=s.appRound,"Y"===s.use_site_header&&i&&i.header_page&&a.loadCode(o,i.header_page),"Y"===s.use_mission_header&&l&&l.header_page&&a.loadCode(o,l.header_page),"Y"===s.use_mission_footer&&l&&l.footer_page&&a.loadCode(o,l.footer_page),"Y"===s.use_site_footer&&i&&i.footer_page&&a.loadCode(o,i.footer_page),a.loadCode(o,r.page).then(function(){e.page=r.page}),n(function(){e.$broadcast("xxt.app.enroll.ready",r)});var c;(c=document.querySelector(".loading"))&&c.parentNode.removeChild(c)},function(){var e;(e=document.querySelector(".loading"))&&e.parentNode.removeChild(e)})}window.gotoPage=function(t){var n;n=e.$root.$$phase,"$digest"===n||"$apply"===n?i():e.$apply(function(){i()})},e.closeWindow=function(){},e.addRecord=function(t,n){n?e.gotoPage(t,n,null,null,"Y"):alert("没有指定登记编辑页")},e.gotoPage=function(e,t,n,o,a){e.preventDefault(),e.stopPropagation();var i=r.j("","site","app");void 0!==n&&null!==n&&n.length&&(i+="&ek="+n),void 0!==o&&null!==o&&o.length&&(i+="&rid="+o),void 0!==t&&null!==t&&t.length&&(i+="&page="+t),void 0!==a&&"Y"===a&&(i+="&newRecord=Y"),location.replace(i)},e.openMatter=function(e,t,n,o){var a="/rest/site/fe/matter?site="+r.s().site+"&id="+e+"&type="+t;n?location.replace(a):!1===o?location.href=a:window.open(a)},i()}]),o.service("srvStorage",["tmsLocation",function(e){var t;t=window.localStorage.getItem("enroll-preview"),t?t=JSON.parse(t):(t={records:{}},window.localStorage.setItem("enroll-preview",JSON.stringify(t))),this.getRecord=function(e){return t.records[e]},this.addRecord=function(e){var n="ek"+1*new Date;return t.records[n]={enroll_key:n,enroll_at:Math.round(1*new Date/1e3),data:e},window.localStorage.setItem("enroll-preview",JSON.stringify(t)),n},this.clean=function(){window.localStorage.removeItem("enroll-preview")}}]),o.service("Record",["srvStorage",function(e){this.current={},this.get=function(t){this.current=e.getRecord(t)||{enroll_at:Math.floor(new Date/1e3)}}}]),o.controller("ctrlRecord",["$scope","Record","tmsLocation","$sce",function(e,t,n,o){var r=e.app._schemasById;t.get(n.s().ek),e.Record=t,e.value2Label=function(e){var n,o,a="",i=[];return r&&t.current.data&&(a=t.current.data[e])&&(n=r[e])&&n.ops&&n.ops.length&&(o=a.split(","),n.ops.forEach(function(e,t){-1!==o.indexOf(n.ops[t].v)&&i.push(n.ops[t].l)}),i.length&&(a=i.join(","))),a},e.score2Html=function(e){var n,a="",i=r[e];return i&&t.current.data&&(n=t.current.data[e])&&i.ops&&i.ops.length&&i.ops.forEach(function(e,t){a+="<div>"+e.l+": "+n[e.v]+"</div>"}),o.trustAsHtml(a)}}]),o.controller("ctrlRecords",[function(){}]),o.controller("ctrlRounds",[function(){}]),o.controller("ctrlOwnerOptions",[function(){}]),o.controller("ctrlStatistic",[function(){}]),o.controller("ctrlPreview",["$scope","tmsLocation","srvStorage",function(e,t,n){e.data={},"Y"===t.s().start&&n.clean(),t.s().ek&&function(){var o=t.s().ek,r=n.getRecord(o);angular.extend(e.data,r.data)}(),e.score=function(t,n,o){var r=e.schemasById[t],a=r.ops[n];void 0===e.data[t]&&(e.data[t]={},r.ops.forEach(function(t){e.data[r.id][t.v]=0})),e.data[t][a.v]=o},e.lessScore=function(t,n,o){var r,a;return!!e.schemasById&&(!!(r=e.schemasById[t])&&(void 0!==e.data[t]&&(a=r.ops[n],e.data[t][a.v]>=o)))},e.submit=function(o,r){var a,i,s;s=angular.copy(e.data),e.app.dataSchemas(function(e){switch(e.type){case"multiple":var t,n=s[e.id],o=[];if(angular.isObject(n)){for(var t in n)o.push(t);s[e.id]=o.join(",")}}}),i=n.addRecord(e.data),void 0!==r&&r.length&&(a=t.j("","site","app"),a+="&page="+r,a+="&ek="+i,location.replace(a))},e.editRecord=function(e,n){var o;void 0!==n&&n.length&&(o=t.j("","site","app"),o+="&page="+n,o+="&ek="+t.s().ek,location.replace(o))}}])},6:function(e,t,n){"use strict";window.__util={},window.__util.makeDialog=function(e,t){var n,o;return o=document.createElement("div"),o.setAttribute("id",e),o.classList.add("dialog","mask"),n="<div class='dialog dlg'>",t.header&&t.header.length&&(n+="<div class='dlg-header'>"+t.header+"</div>"),n+="<div class='dlg-body'>"+t.body+"</div>",t.footer&&t.footer.length&&(n+="<div class='dlg-footer'>"+t.footer+"</div>"),n+="</div>",o.innerHTML=n,document.body.appendChild(o),o.children};var o=angular.module("directive.enroll",[]);o.directive("tmsDate",["$compile",function(e){return{restrict:"A",scope:{value:"=tmsDateValue"},controller:["$scope",function(e){e.close=function(){var t;t=document.querySelector("#"+e.dialogID),document.body.removeChild(t),e.opened=!1},e.ok=function(){var t;t=new Date,t.setTime(0),t.setFullYear(e.data.year),t.setMonth(e.data.month-1),t.setDate(e.data.date),t.setHours(e.data.hour),t.setMinutes(e.data.minute),e.value=parseInt(t.getTime()/1e3),e.close()}}],link:function(t,n,o){var r,a,i,s;void 0===t.value&&(t.value=1*new Date/1e3),a=new Date,a.setTime(1e3*t.value),t.options={years:[2014,2015,2016,2017,2018,2019,2020],months:[1,2,3,4,5,6,7,8,9,10,11,12],dates:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],hours:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23],minutes:[0,5,10,15,20,25,30,35,40,45,50,55]},i=5*Math.round(a.getMinutes()/5),t.data={year:a.getFullYear(),month:a.getMonth()+1,date:a.getDate(),hour:a.getHours(),minute:i},-1===t.options.minutes.indexOf(i)&&t.options.minutes.push(i),s='<div class="form-group"><select class="form-control" ng-model="data.year" ng-options="y for y in options.years"></select></div>',s+='<div class="form-group"><select class="form-control" ng-model="data.month" ng-options="m for m in options.months"></select></div>',s+='<div class="form-group"><select class="form-control" ng-model="data.date" ng-options="d for d in options.dates"></select></div>',s+='<div class="form-group"><select class="form-control" ng-model="data.hour" ng-options="h for h in options.hours"></select></div>',s+='<div class="form-group"><select class="form-control" ng-model="data.minute" ng-options="mi for mi in options.minutes"></select></div>',r=function(n){if(n.preventDefault(),n.stopPropagation(),!t.opened){var o,r;r="_dlg-"+1*new Date,o={header:"",body:s,footer:'<button class="btn btn-default" ng-click="close()">关闭</button><button class="btn btn-success" ng-click="ok()">确定</button>'},o=__util.makeDialog(r,o),t.opened=!0,t.dialogID=r,e(o)(t)}},n[0].querySelector("[ng-bind]").addEventListener("click",r)}}}]),o.directive("flexImg",function(){return{restrict:"A",replace:!0,template:"<img ng-src='{{img.imgSrc}}'>",link:function(e,t,n){angular.element(t).on("load",function(){var e,t,n=this.clientWidth,o=this.clientHeight;n>o?(e=n/o*80,angular.element(this).css({height:"100%",width:e+"px",top:"0",left:"50%","margin-left":-1*e/2+"px"})):(t=o/n*80,angular.element(this).css({width:"100%",height:t+"px",left:"0",top:"50%","margin-top":-1*t/2+"px"}))})}}}),o.directive("tmsHideParentHeight",function(){return{restrict:"A",link:function(e,t,n){var o,r;if(n.tmsHideParentHeight){o=n.tmsHideParentHeight;for(var a=0,i=t.length;a<i;a++)r=t[a],r.parentElement&&window.addEventListener("resize",function(){r.classList.toggle("hidden",r.parentElement.clientHeight<o)})}}}}),o.directive("tmsScrollSpy",function(){return{restrict:"A",scope:{selector:"@selector",offset:"@",onbottom:"&",toggleSpy:"="},link:function(e,t,n){var o="window"===e.selector?window:document.querySelector(e.selector);o.addEventListener("scroll",function(t){var n=o===window?t.target.documentElement:t.target;e.toggleSpy&&e.onbottom&&angular.isFunction(e.onbottom)&&n.clientHeight+n.scrollTop+parseInt(e.offset)>=n.scrollHeight&&e.$apply(function(){e.toggleSpy=!1,e.onbottom()})})}}})},76:function(e,t,n){e.exports=n(43)}});